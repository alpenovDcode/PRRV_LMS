# API Endpoints - –ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

## üîê 2FA (–î–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è)

### GET /api/auth/2fa/setup
–ü–æ–ª—É—á–∏—Ç—å QR –∫–æ–¥ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ 2FA

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:** –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "data": {
    "secret": "string",
    "qrCodeUrl": "otpauth://totp/...",
    "backupCodes": ["CODE1", "CODE2", ...]
  }
}
```

### POST /api/auth/2fa/setup
–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∏ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å 2FA

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:** –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

**Body:**
```json
{
  "token": "123456"
}
```

### POST /api/auth/2fa/disable
–û—Ç–∫–ª—é—á–∏—Ç—å 2FA (—Ç—Ä–µ–±—É–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∫–æ–¥–æ–º)

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:** –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

**Body:**
```json
{
  "code": "123456"
}
```

---

## üì± –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏

### GET /api/auth/sessions
–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Å—Å–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:** –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "data": [
    {
      "id": "uuid",
      "sessionId": "string",
      "deviceName": "Chrome on Mac",
      "deviceType": "desktop",
      "ipAddress": "192.168.1.1",
      "lastActivityAt": "2024-12-05T10:00:00Z",
      "createdAt": "2024-12-05T09:00:00Z"
    }
  ]
}
```

### DELETE /api/auth/sessions?sessionId=xxx
–£–¥–∞–ª–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é —Å–µ—Å—Å–∏—é

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:** –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `sessionId` - ID —Å–µ—Å—Å–∏–∏ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è
- `allOthers=true` - —É–¥–∞–ª–∏—Ç—å –≤—Å–µ –¥—Ä—É–≥–∏–µ —Å–µ—Å—Å–∏–∏ (–∫—Ä–æ–º–µ —Ç–µ–∫—É—â–µ–π)

---

## üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ —É—Ä–æ–∫–∞–º

### GET /api/lessons/[id]/comments
–ü–æ–ª—É—á–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ —É—Ä–æ–∫—É (—Å –∏–µ—Ä–∞—Ä—Ö–∏–µ–π)

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:** –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "data": [
    {
      "id": "uuid",
      "content": "–¢–µ–∫—Å—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è",
      "user": {
        "id": "uuid",
        "email": "user@example.com",
        "fullName": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",
        "avatarUrl": "url"
      },
      "replies": [...],
      "createdAt": "2024-12-05T10:00:00Z"
    }
  ]
}
```

### POST /api/lessons/[id]/comments
–°–æ–∑–¥–∞—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ —É—Ä–æ–∫—É

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:** –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

**Body:**
```json
{
  "content": "–¢–µ–∫—Å—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è",
  "parentId": "uuid" // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
}
```

### DELETE /api/comments/[id]
–£–¥–∞–ª–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π (–º—è–≥–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ)

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:** –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (—Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä –∏–ª–∏ –∞–¥–º–∏–Ω)

---

## üìÇ –ú–µ–¥–∏–∞-–±–∏–±–ª–∏–æ—Ç–µ–∫–∞

### GET /api/admin/media
–ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –º–µ–¥–∏–∞-—Ñ–∞–π–ª–æ–≤

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:** –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è, —Ä–æ–ª—å `admin`

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `mimeType` - —Ñ–∏–ª—å—Ç—Ä –ø–æ —Ç–∏–ø—É —Ñ–∞–π–ª–∞
- `limit` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 50)
- `offset` - —Å–º–µ—â–µ–Ω–∏–µ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 0)

### POST /api/admin/media
–°–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å –æ –º–µ–¥–∏–∞-—Ñ–∞–π–ª–µ

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:** –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è, —Ä–æ–ª—å `admin`

**Body:**
```json
{
  "name": "file.pdf",
  "originalName": "–ú–µ—Ç–æ–¥–∏—á–∫–∞.pdf",
  "mimeType": "application/pdf",
  "size": 1024000,
  "url": "https://storage.example.com/files/file.pdf"
}
```

### GET /api/admin/media/[id]
–ü–æ–ª—É—á–∏—Ç—å signed URL –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –º–µ–¥–∏–∞-—Ñ–∞–π–ª—É

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:** –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- –ê–¥–º–∏–Ω—ã: –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —Ñ–∞–π–ª–∞–º
- –°—Ç—É–¥–µ–Ω—Ç—ã: —Ç–æ–ª—å–∫–æ –∫ —Ñ–∞–π–ª–∞–º, –ø—Ä–∏–∫—Ä–µ–ø–ª–µ–Ω–Ω—ã–º –∫ –¥–æ—Å—Ç—É–ø–Ω—ã–º —É—Ä–æ–∫–∞–º

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "data": {
    "signedUrl": "https://storage.example.com/files/file.pdf?token=..."
  }
}
```

### DELETE /api/admin/media/[id]
–£–¥–∞–ª–∏—Ç—å –º–µ–¥–∏–∞-—Ñ–∞–π–ª

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:** –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è, —Ä–æ–ª—å `admin`

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ:** –ù–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å —Ñ–∞–π–ª, –µ—Å–ª–∏ –æ–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —É—Ä–æ–∫–∞—Ö

### POST /api/admin/lessons/[id]/media
–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å –º–µ–¥–∏–∞-—Ñ–∞–π–ª –∫ —É—Ä–æ–∫—É

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:** –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è, —Ä–æ–ª—å `admin`

**Body:**
```json
{
  "mediaId": "uuid",
  "orderIndex": 0 // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
}
```

### DELETE /api/admin/lessons/[id]/media?mediaId=xxx
–û—Ç–∫—Ä–µ–ø–∏—Ç—å –º–µ–¥–∏–∞-—Ñ–∞–π–ª –æ—Ç —É—Ä–æ–∫–∞

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:** –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è, —Ä–æ–ª—å `admin`

---

## üîî –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### GET /api/notifications/preferences
–ü–æ–ª—É—á–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:** –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "data": {
    "id": "uuid",
    "userId": "uuid",
    "channels": {
      "email": true,
      "telegram": false,
      "inApp": true
    },
    "preferences": {
      "homeworkReviewed": true,
      "newComment": true,
      "lessonAvailable": true,
      "deadlineReminder": true,
      "quizResult": true
    }
  }
}
```

### PATCH /api/notifications/preferences
–û–±–Ω–æ–≤–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:** –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

**Body:**
```json
{
  "channels": {
    "email": true,
    "telegram": false,
    "inApp": true
  },
  "preferences": {
    "homeworkReviewed": true,
    "newComment": false
  }
}
```

---

## üìù –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–≤–∏–∑–æ–≤ (–ö—É—Ä–∞—Ç–æ—Ä)

### GET /api/curator/quiz/[id]
–ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ø—ã—Ç–∫–µ –∫–≤–∏–∑–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:** –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è, —Ä–æ–ª—å `curator` –∏–ª–∏ `admin`

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "data": {
    "id": "uuid",
    "userId": "uuid",
    "lessonId": "uuid",
    "attemptNumber": 1,
    "answers": {...},
    "score": null,
    "requiresReview": true,
    "user": {...},
    "lesson": {...}
  }
}
```

### PATCH /api/curator/quiz/[id]
–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–≤–∏–∑ –≤—Ä—É—á–Ω—É—é

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:** –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è, —Ä–æ–ª—å `curator` –∏–ª–∏ `admin`

**Body:**
```json
{
  "score": 85,
  "comment": "–•–æ—Ä–æ—à–∞—è —Ä–∞–±–æ—Ç–∞, –Ω–æ –µ—Å—Ç—å –æ—à–∏–±–∫–∏"
}
```

### DELETE /api/curator/quiz/[id]?userId=xxx
–°–±—Ä–æ—Å–∏—Ç—å –ø–æ–ø—ã—Ç–∫–∏ –∫–≤–∏–∑–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:** –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è, —Ä–æ–ª—å `curator` –∏–ª–∏ `admin`

**Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `userId` - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –¥–ª—è –∫–æ—Ç–æ—Ä–æ–≥–æ —Å–±—Ä–æ—Å–∏—Ç—å –ø–æ–ø—ã—Ç–∫–∏

---

## üìä –ö–≤–∏–∑—ã (–°—Ç—É–¥–µ–Ω—Ç)

### GET /api/lessons/[id]/quiz
–ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –Ω–∞—á–∞—Ç—å –∫–≤–∏–∑

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:** –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "data": {
    "canStart": true,
    "attemptsLeft": 2,
    "reason": null
  }
}
```

### POST /api/lessons/[id]/quiz
–ù–∞—á–∞—Ç—å –Ω–æ–≤—É—é –ø–æ–ø—ã—Ç–∫—É –∫–≤–∏–∑–∞

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:** –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "data": {
    "attemptId": "uuid",
    "attemptNumber": 1,
    "timeLimit": 3600
  }
}
```

### PATCH /api/lessons/[id]/quiz
–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç—ã –Ω–∞ –∫–≤–∏–∑

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:** –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

**Body:**
```json
{
  "attemptId": "uuid",
  "answers": {
    "question1": "answer1",
    "question2": ["answer2a", "answer2b"]
  }
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "data": {
    "score": 85,
    "isPassed": true,
    "requiresReview": false,
    "timeSpent": 1800
  }
}
```

---

## üìö –ò—Å—Ç–æ—Ä–∏—è –¥–æ–º–∞—à–Ω–∏—Ö –∑–∞–¥–∞–Ω–∏–π

### GET /api/homework/[id]/history
–ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –≤–µ—Ä—Å–∏–π –¥–æ–º–∞—à–Ω–µ–≥–æ –∑–∞–¥–∞–Ω–∏—è

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:** –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
- –°—Ç—É–¥–µ–Ω—Ç: —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –∑–∞–¥–∞–Ω–∏—è
- –ö—É—Ä–∞—Ç–æ—Ä/–ê–¥–º–∏–Ω: –≤—Å–µ –∑–∞–¥–∞–Ω–∏—è

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "data": [
    {
      "id": "uuid",
      "content": "–¢–µ–∫—Å—Ç –î–ó",
      "files": [...],
      "status": "pending",
      "curatorComment": null,
      "curator": null,
      "createdAt": "2024-12-05T10:00:00Z"
    }
  ]
}
```

---

## üîí –ö–æ–¥—ã –æ—à–∏–±–æ–∫

- `ALREADY_ENABLED` - 2FA —É–∂–µ –≤–∫–ª—é—á–µ–Ω–∞
- `INVALID_TOKEN` - –ù–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω 2FA
- `INVALID_CODE` - –ù–µ–≤–µ—Ä–Ω—ã–π –∫–æ–¥ 2FA
- `COMMENTS_DISABLED` - –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –æ—Ç–∫–ª—é—á–µ–Ω—ã –¥–ª—è —É—Ä–æ–∫–∞
- `NOT_FOUND` - –†–µ—Å—É—Ä—Å –Ω–µ –Ω–∞–π–¥–µ–Ω
- `FORBIDDEN` - –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞
- `VALIDATION_ERROR` - –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
- `MAX_ATTEMPTS` - –ü—Ä–µ–≤—ã—à–µ–Ω–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫
- `CANNOT_START` - –ù–µ–ª—å–∑—è –Ω–∞—á–∞—Ç—å –∫–≤–∏–∑
- `TIME_LIMIT_EXCEEDED` - –í—Ä–µ–º—è –Ω–∞ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ –∫–≤–∏–∑–∞ –∏—Å—Ç–µ–∫–ª–æ
- `NO_REVIEW_NEEDED` - –ü–æ–ø—ã—Ç–∫–∞ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏
- `IN_USE` - –§–∞–π–ª –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —É—Ä–æ–∫–∞—Ö

