<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞ –¥–ª—è prrv.tech</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2563eb;
            margin-top: 0;
        }
        .step {
            background: #f0f9ff;
            border-left: 4px solid #2563eb;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
        .success {
            background: #f0fdf4;
            border-left-color: #059669;
            color: #059669;
        }
        .warning {
            background: #fffbeb;
            border-left-color: #f59e0b;
            color: #92400e;
        }
        button {
            background: #2563eb;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background: #1d4ed8;
        }
        .log {
            background: #1f2937;
            color: #10b981;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
        }
        .log div {
            margin: 5px 0;
        }
        code {
            background: #e5e7eb;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß –û—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞ –¥–ª—è prrv.tech</h1>
        
        <div class="warning step">
            <strong>‚ö†Ô∏è –í–Ω–∏–º–∞–Ω–∏–µ!</strong><br>
            –≠—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–º–æ–∂–µ—Ç —Ä–µ—à–∏—Ç—å –ø—Ä–æ–±–ª–µ–º—É —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ —Å—Ç–∞—Ä–æ–º—É IP –∞–¥—Ä–µ—Å—É (0.0.0.0:3000).
        </div>

        <div class="step">
            <h3>–ß—Ç–æ –±—É–¥–µ—Ç —Å–¥–µ–ª–∞–Ω–æ:</h3>
            <ul>
                <li>–û—á–∏—Å—Ç–∫–∞ LocalStorage –∏ SessionStorage</li>
                <li>–£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö cookies –¥–ª—è prrv.tech</li>
                <li>–û—Ç–º–µ–Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ Service Workers</li>
                <li>–û—á–∏—Å—Ç–∫–∞ IndexedDB</li>
                <li>–û—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</li>
            </ul>
        </div>

        <button onclick="cleanupAll()">üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ–ª–Ω—É—é –æ—á–∏—Å—Ç–∫—É</button>
        <button onclick="clearCookies()">üç™ –¢–æ–ª—å–∫–æ cookies</button>
        <button onclick="clearStorage()">üíæ –¢–æ–ª—å–∫–æ storage</button>
        <button onclick="unregisterSW()">‚öôÔ∏è –¢–æ–ª—å–∫–æ service workers</button>

        <div id="log" class="log" style="display: none;"></div>

        <div class="step" style="margin-top: 30px;">
            <h3>–†—É—á–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ (–µ—Å–ª–∏ —Å–∫—Ä–∏–ø—Ç –Ω–µ –ø–æ–º–æ–≥):</h3>
            <ol>
                <li>
                    <strong>Chrome/Edge:</strong><br>
                    –û—Ç–∫—Ä–æ–π—Ç–µ <code>chrome://net-internals/#hsts</code><br>
                    –í —Ä–∞–∑–¥–µ–ª–µ "Delete domain security policies" –≤–≤–µ–¥–∏—Ç–µ <code>prrv.tech</code> –∏ –Ω–∞–∂–º–∏—Ç–µ Delete
                </li>
                <li>
                    <strong>Firefox:</strong><br>
                    –û—Ç–∫—Ä–æ–π—Ç–µ <code>about:preferences#privacy</code><br>
                    Cookies and Site Data ‚Üí Manage Data ‚Üí –ù–∞–π–¥–∏—Ç–µ prrv.tech ‚Üí Remove Selected
                </li>
                <li>
                    <strong>–û—á–∏—Å—Ç–∫–∞ DNS –∫–µ—à–∞:</strong><br>
                    <strong>Windows:</strong> <code>ipconfig /flushdns</code><br>
                    <strong>Mac:</strong> <code>sudo dscacheutil -flushcache; sudo killall -HUP mDNSResponder</code><br>
                    <strong>Linux:</strong> <code>sudo systemd-resolve --flush-caches</code>
                </li>
            </ol>
        </div>

        <div class="success step" id="finalStep" style="display: none;">
            <strong>‚úÖ –ì–æ—Ç–æ–≤–æ!</strong><br>
            –¢–µ–ø–µ—Ä—å –∑–∞–∫—Ä–æ–π—Ç–µ –í–°–ï –≤–∫–ª–∞–¥–∫–∏ —Å prrv.tech –∏ –æ—Ç–∫—Ä–æ–π—Ç–µ —Å–∞–π—Ç –∑–∞–Ω–æ–≤–æ:<br>
            <a href="https://prrv.tech" target="_blank" style="color: #059669; font-weight: bold;">https://prrv.tech</a>
        </div>
    </div>

    <script>
        const log = document.getElementById('log');
        const finalStep = document.getElementById('finalStep');

        function addLog(message, type = 'info') {
            log.style.display = 'block';
            const div = document.createElement('div');
            const timestamp = new Date().toLocaleTimeString();
            const icon = type === 'success' ? '‚úì' : type === 'error' ? '‚úó' : '‚Üí';
            div.innerHTML = `[${timestamp}] ${icon} ${message}`;
            div.style.color = type === 'success' ? '#10b981' : type === 'error' ? '#ef4444' : '#60a5fa';
            log.appendChild(div);
            log.scrollTop = log.scrollHeight;
        }

        async function clearStorage() {
            addLog('–û—á–∏—Å—Ç–∫–∞ LocalStorage...');
            try {
                localStorage.clear();
                addLog('LocalStorage –æ—á–∏—â–µ–Ω', 'success');
            } catch (e) {
                addLog('–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ LocalStorage: ' + e.message, 'error');
            }

            addLog('–û—á–∏—Å—Ç–∫–∞ SessionStorage...');
            try {
                sessionStorage.clear();
                addLog('SessionStorage –æ—á–∏—â–µ–Ω', 'success');
            } catch (e) {
                addLog('–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ SessionStorage: ' + e.message, 'error');
            }

            // Clear IndexedDB
            addLog('–û—á–∏—Å—Ç–∫–∞ IndexedDB...');
            try {
                const databases = await indexedDB.databases();
                for (const db of databases) {
                    indexedDB.deleteDatabase(db.name);
                    addLog(`IndexedDB "${db.name}" —É–¥–∞–ª–µ–Ω–∞`, 'success');
                }
            } catch (e) {
                addLog('–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ IndexedDB: ' + e.message, 'error');
            }
        }

        function clearCookies() {
            addLog('–û—á–∏—Å—Ç–∫–∞ cookies...');
            const cookies = document.cookie.split(';');
            let count = 0;
            
            for (let cookie of cookies) {
                const eqPos = cookie.indexOf('=');
                const name = eqPos > -1 ? cookie.substr(0, eqPos).trim() : cookie.trim();
                
                // Delete for current domain
                document.cookie = name + '=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/';
                document.cookie = name + '=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/;domain=' + location.hostname;
                document.cookie = name + '=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/;domain=.prrv.tech';
                document.cookie = name + '=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/;domain=prrv.tech';
                count++;
            }
            
            addLog(`–£–¥–∞–ª–µ–Ω–æ ${count} cookies`, 'success');
        }

        async function unregisterSW() {
            addLog('–û—Ç–º–µ–Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ Service Workers...');
            
            if ('serviceWorker' in navigator) {
                try {
                    const registrations = await navigator.serviceWorker.getRegistrations();
                    
                    if (registrations.length === 0) {
                        addLog('Service Workers –Ω–µ –Ω–∞–π–¥–µ–Ω—ã', 'success');
                        return;
                    }
                    
                    for (let registration of registrations) {
                        await registration.unregister();
                        addLog(`Service Worker –æ—Ç–º–µ–Ω–µ–Ω: ${registration.scope}`, 'success');
                    }
                } catch (e) {
                    addLog('–û—à–∏–±–∫–∞ –æ—Ç–º–µ–Ω—ã Service Workers: ' + e.message, 'error');
                }
            } else {
                addLog('Service Workers –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è', 'success');
            }
        }

        async function clearCache() {
            addLog('–û—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...');
            
            if ('caches' in window) {
                try {
                    const cacheNames = await caches.keys();
                    
                    if (cacheNames.length === 0) {
                        addLog('–ö–µ—à –Ω–µ –Ω–∞–π–¥–µ–Ω', 'success');
                        return;
                    }
                    
                    for (let cacheName of cacheNames) {
                        await caches.delete(cacheName);
                        addLog(`–ö–µ—à —É–¥–∞–ª–µ–Ω: ${cacheName}`, 'success');
                    }
                } catch (e) {
                    addLog('–û—à–∏–±–∫–∞ –æ—á–∏—Å—Ç–∫–∏ –∫–µ—à–∞: ' + e.message, 'error');
                }
            } else {
                addLog('Cache API –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è', 'success');
            }
        }

        async function cleanupAll() {
            addLog('=== –ù–∞—á–∞–ª–æ –ø–æ–ª–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏ ===');
            
            await clearStorage();
            clearCookies();
            await unregisterSW();
            await clearCache();
            
            addLog('=== –û—á–∏—Å—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ ===', 'success');
            finalStep.style.display = 'block';
            
            addLog('–í–ê–ñ–ù–û: –ó–∞–∫—Ä–æ–π—Ç–µ –í–°–ï –≤–∫–ª–∞–¥–∫–∏ —Å prrv.tech –∏ –æ—Ç–∫—Ä–æ–π—Ç–µ —Å–∞–π—Ç –∑–∞–Ω–æ–≤–æ!', 'success');
        }

        // Auto-run on load if query parameter is present
        if (window.location.search.includes('auto')) {
            window.addEventListener('load', () => {
                setTimeout(cleanupAll, 500);
            });
        }
    </script>
</body>
</html>
